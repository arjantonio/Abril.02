---
title: "Practica2"
output:
  pdf_document: 
    latex_engine: xelatex
  html_document: default
date: "2023-04-21"

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r carga_librerias, echo = FALSE}
library(GET)
library(readr)
library(rvest)
library(httr)
library(XML)
library(stringr)
library(tidyr)
library(dplyr) 
library(purrr)
library(ggplot2)
library(ggpubr)
library(gridExtra)
library(knitr)
```
### Pregunta 1

1. Descargar la página web de la URL indicada, y almacenarlo en un formato de R apto para ser tratado.

```{r web_page, echo = TRUE}
# Almacenando la URl 
html <- GET("https://www.mediawiki.org/wiki/MediaWiki")
# Descargando contenido de la página web
contenido <- content(html, as = "text")
# Analizando el contenido de la página web
parsedHtml <- htmlParse(contenido, asText = TRUE)
```

2. Analizar el contenido de la web, buscando el título de la página (que en HTML se etiqueta como “title”).

```{r title, eval= TRUE, echo = TRUE}
# Obteniendo el título de la web
xpath <- "//title"
# Utilizando la función: xpathSApply()
titulos <- xpathSApply(parsedHtml, xpath, xmlValue)
# Se muestra el Título de la Pagina Web
cat("Título de la Página Web:\n")
cat(titulos, sep = "\n")
```
3. Analizar el contenido de la web, buscando todos los enlaces (que en HTML se etiquetan como “a”), buscando el texto del enlace, así como la URL.

```{r link, echo = TRUE}
# Extrayendo los nombres de la etiqueta <a></a>
name_hyperlink <- xpathSApply(parsedHtml, "//a", xmlValue)
#name_hyperlink 
# Extrayendo los valores del atributo href de la etiqueta <a></a>
url_hyperlink <- xpathSApply(parsedHtml, "//a", xmlGetAttr, "href")

# Validando si los nombres de la etiqueta tienen valores null
null_name <- sapply(name_hyperlink, is.null)
# Validando si los valores del atributo href tienen valores null
null_href <- sapply(url_hyperlink, is.null)
# Reemplazando los valores null por el valor NA
name_hyperlink[null_name] <- NA
url_hyperlink[null_href] <- NA
# Convirtiendo de lista a vector los nombres y el valor del href del la etiqueta <a></a>
name_hyperlink <- unlist(name_hyperlink)
url_hyperlink  <- unlist(url_hyperlink)

# Creando una tabla con el texto y su respectivo url del enlace
links_tables <- data.frame(Text = name_hyperlink, Url = url_hyperlink)

kable(links_tables)

```
4. Generar una tabla con cada enlace encontrado, indicando el texto que acompaña el enlace, y el número de veces que aparece un enlace con ese mismo objetivo.

```{r link_table, echo = TRUE}

# Convirtiendo a data.frame y hallando el n° de repeticiones
concurrences <- as.data.frame(table(links_tables))

# Filtrando solo los enlaces existentes, es decir todos lo que tenga >0 en la columna freq y lo ordenamos en orden alfábetico
links_data <- filter(concurrences, Freq > 0) %>% arrange(Text)
kable(links_data)

```
5. Para cada enlace, seguirlo e indicar si está activo (podemos usar el código de status HTTP al hacer una petición a esa URL).

```{r status_code, echo = TRUE}
# Agregando la URL completa 
base_url <- "https://www.mediawiki.org"

# Validando los carácteres al inicio de la columna URL y uniendolo con la url base
links_data$Final_Url <- case_when(
  # validando los carácteres al inicio de la URL
  grepl("^/wiki/|^/w/|^//", links_data$Url) | grepl("^#", links_data$Url) ~ paste0(base_url, links_data$Url),
  grepl("^https", links_data$Url) ~ links_data$Url,
  TRUE ~ NA_character_
)

# Incorporando el valor status_code 
# Demora 1 minuto
# Recorriendo los datos para incorporar HEAD y hallar el status_code
cat("En Proceso... \n")
status_codes <- map(links_data$Final_Url, HEAD)
# Agregando una columna con el status_code respectivo
links_data$Status_Code <- map(status_codes, status_code)
# Convirtiendo de lista a character
links_data$Status_Code <- as.character(links_data$Status_Code)
kable(links_data)
cat("Proceso terminado \n")

```


```{r cars}
html <- GET("https://www.mediawiki.org/wiki/MediaWiki")
content <- content(html, as = "text")
parsedHtml <- htmlParse(content)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
